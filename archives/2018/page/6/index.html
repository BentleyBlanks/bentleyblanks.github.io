


<!DOCTYPE html>
<html lang="">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
  <!-- responsive-->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Archives: 2018 [ Bingo ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/elenore/css/elenore.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="/css/floekr.css">
    
  

  <!-- highlight -->
  <link rel="stylesheet" href="/highlight/styles/monokai-sublime.css">
  <script src="/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>
<body>

<!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Navigation Bar -->
<nav id="navbar" class="navbar is-white is-fixed-top">
  <div id="specialShadow" class="el-special-shadow"></div>
  <div class="container">

    <!-- left side, always visible -->
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <!-- <strong>Bingo</strong> -->
        <i class="fa fa-lg fa-home"></i>
      </a>

      <!-- toggles the menu on touch devices -->
      <div id="navbarBurger" class="navbar-burger burger" data-target="navMenu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <!-- menu -->
    <div id="navMenu" class="navbar-menu">
        <div class="navbar-end">
          
            
            <a href="/" class="navbar-item">HOME</a>
            

            

            
          
            

            

            
            <a href="/projects" class="navbar-item" >PROJECTS</a>
            
          
            

            
            <a href="/about" class="navbar-item">ABOUT</a>
            

            
          
        </div>
    </div>
  </div>
</nav>

<!-- index hero -->
<div class="hero is-large has-background-fixed" id="indexHero">
  <div class="hero-body">
    <div class="container has-text-centered">
      <p id="titleContent">
        Bingo, <span>Computer Graphics</span> & <span>Game Developer</span>
      </p>
    </div>
  </div>
</div>

<!-- articles and about me -->

<section class="section">
  <div class="container">
    <!-- content and about me -->
    <div class="columns">
      <!-- blog -->
      <div class="column is-two-thirds">
        <div class="columns is-multiline">
          <div class="column is-12">
            <!-- articles -->
            
                
                  <div class="card is-white is-hover" id="articleCard">
                    <div class="card-header">
                      <a href="/2018/03/12/2016-1-24-Mathematical Foundations of Monte Carlo Methods 1/" class="card-header-title">
                        Mathematical Foundations of Monte Carlo Methods 1
                      </a>
                    </div>
                    <div class="card-content">
                      <p id="articleContent">
                        <blockquote>
<p>本文为在<a href="http://www.scratchapixel.com/lessons/mathematics-physics-for-computer-graphics/monte-carlo-methods-mathematical-foundations/quick-introduction-to-monte-carlo-methods" target="_blank" rel="noopener">Scratchapixel</a>上学习的翻译读后感与部分个人解读。这里不会将全篇的内容系数翻译，保留原文以便后期自行理解，笔者只精炼一些文章中关键的点出来便于记录。</p>
</blockquote>
<h3 id="Random-Variables-and-Probability"><a href="#Random-Variables-and-Probability" class="headerlink" title="Random Variables and Probability"></a>Random Variables and Probability</h3><p>随机变量(random variable):A random variable is not a fixed value, but a function, mapping or associating a unique numerical value to each possible outcome of a random process which is not necessarily a number.</p>
<blockquote>
<p>随机变量本质上就是一个将随机实验结果，映射到实际数据上的函数$X(e)$。</p>
</blockquote>
<p>采样空间(sample space):A sample space defines the set of all possible outcomes from an experiment. </p>
<blockquote>
<p>采样空间可以用于定义<a href="http://en.wikipedia.org/wiki/Elementary_event" target="_blank" rel="noopener">基本事件</a>与<a href="http://en.wikipedia.org/wiki/Sigma-algebra" target="_blank" rel="noopener">非基本事件</a>。假定你现在有10张牌，3张为0，5张为1，2张为2。那么采样的非基本事件的采样空间就为$S = \{0, 0, 0, 1, 1, 1, 1, 1, 2, 2 \}$，而基本事件的采样空间就为$S = \{ 0, 1, 2 \}$。</p>
</blockquote>
<p><br></p>
<table>
<thead>
<tr>
<th>名词</th>
<th>释义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Random Variable</td>
<td>A random variable is a function X defined from a sample space S to a measurable space (1, 0). Random variables are denoted with upper case letters.</td>
</tr>
<tr>
<td>Probability</td>
<td>A probability provides a quantatative description of the likely occurrence of a particular event.</td>
</tr>
<tr>
<td>Observation or Realization</td>
<td>A realization, or observed value, of a random variable is the value that is actually observed.</td>
</tr>
<tr>
<td>Event</td>
<td>An event is any collection of outcomes of an experiment. Any subset of the sample space is an event.</td>
</tr>
<tr>
<td>Sample Space</td>
<td>Exhaustive list of all the possible outcomes of an experiment. Each possible result of such experiment is represented by one and only one point in the sample space, which is usually denoted by $S$. The elements of the sample space can be thought of as all the different possibilities that could happen.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="Probability-Distrubution"><a href="#Probability-Distrubution" class="headerlink" title="Probability Distrubution"></a>Probability Distrubution</h3><p>伯努利分布(Bernoulli trail):In probability theory when a random process has only two outcomes.</p>
<p>二项分布(Binomial Distribution):We want to find the probability that $S=n$, where $n≤N$, which is the probability that $n$ of the $N$ samples take on the value of 1, and $N−n$ samples take on the value of 0:</p>
<p>$$Pr(S=n)=C^N_n p^k (1−p)^{(N−n)}$$</p>
<p>for n = 0, 1, 2, …, N, where:</p>
<p>$$C^N_n=\frac{N!}{n!(N−n)!}$$</p>
<blockquote>
<p>更多的概率分布函数，比如均匀分布，泊松分布等等可以在这里找到<a href="https://en.wikipedia.org/wiki/List_of_probability_distributions" target="_blank" rel="noopener">List of probability distributions</a>.</p>
</blockquote>
<hr>
<h3 id="Probablity-Properties"><a href="#Probablity-Properties" class="headerlink" title="Probablity Properties"></a>Probablity Properties</h3><p>枚举事件(Collectively exhaustive events):A set of events is said to be jointly or collectively exhaustive if at least one of the event must occur.</p>
<p>互斥事件(Mutually exclusive events):Two sets A and B are said to be <strong>mutually exclusive</strong> or <strong>disjoint</strong>  if A and B have no elements in common.</p>
<blockquote>
<p> 抛硬币本身就既是一个枚举事件，又是一个互斥事件:你可以保证得到的事件结果只有面和花两种(可枚举)，且若出现花的一面则另一面不会出现，反之成立(互斥事件)</p>
</blockquote>
<p>独立事件(Independent event):When you toss a coin the probability of getting heads or tails is $\frac{1}{2}$ as we know it, but if you toss the coin a second time, the probability of getting either heads or tails is still $\frac{1}{2}$. In other words, the first toss did not change the outcome of the second toss or to say it differently again, the chances of getting heads or tails on the second toss are completely independent of whether or not we got “tails” or “heads” in the first toss.</p>
<blockquote>
<p>独立事件有别于前两者，只是表示每一次事件的发生不会因为上一次事件的发生而影响其发生概率。独立事件之间可以遵循乘法规则，也就是$Pr(A∩B) = Pr(A)Pr(B)$.</p>
</blockquote>
<hr>
<h3 id="Introduction-to-Statistics"><a href="#Introduction-to-Statistics" class="headerlink" title="Introduction to Statistics"></a>Introduction to Statistics</h3><p>统计学(Statistics):The goal of statistics is to provide information on random variables and probability distributions we don’t know anything about in the first place. </p>
<p>有偏(Bias):By “randomly” we mean that the process by which we select elements in the population, doesn’t give more importance to some elements than others. If it was the case we would introduce what we call <strong>bias</strong> in the calculation of this estimate.</p>
<blockquote>
<p>也就是不在统计的随机过程中加入人为的统计因素，这将会导致偏差。但正如前文描述，Bias也不是一无是处，有时候在图形学中有偏的方法可以在更小的画面影响下更快的得到，甚至得到比无偏的方法更接近与收敛值。这其实是一个权衡利弊的结果。</p>
</blockquote>
<p>采样/统计(Sample or Statistics):Our random variable really is some sort of “sampler”, it’s a tool or a function on the population, that we can use to collect data on that population, and the collected data makes up what we call the observations and the group of observations itself is what we call a <strong>sample</strong> or <strong>statistics</strong>.</p>
<hr>
<h3 id="Expected-Value"><a href="#Expected-Value" class="headerlink" title="Expected Value"></a>Expected Value</h3><p>期望(Expected Value):The mean and the expected value are equal however the mean is a simple average of numbers not weighted by anything, while the expected value is a sum of numbers weighted by their probability:</p>
<p>$$E = \sum^N_{i=1}p_ix_i$$</p>
<blockquote>
<p> 换言之，随机变量在采样数不断变大后会向一个值收敛，而这个值就是所求的数学期望</p>
</blockquote>
<p>样本均值(Sample mean):the mean of a collection of observations produced by a random variable X, is called a sample mean:</p>
<p>$$\bar{X}_n = \frac{1}{n}(X_1+X_2+X_3+…+X_n)$$</p>
<p>独立同分布(Independent and Identically Distributed,i.i.d):Where $X_1,X_2, …$ is a sequence of random variables which have the property to be independent and identically distributed.</p>
<blockquote>
<p>如果随机变量序列或者其他随机变量有相同的概率分布，并且他们之间互相独立，那么这些随机变量是独立同分布的。</p>
<p>当$ω$为随机变量采样空间中的一个采样结果时，可以这样表述$x=X(ω)$。 所以以下方式可以$\bar{X}=\frac{1}{n}(x_1+x_2+…+x_n)$也可以改写为 $\bar{X}=\frac{1}{n} (X_1(ω)+X_2(ω)+…+X_n(ω)$。上述$ X_1,X_2, … $可以作为随机变量$X$的一个实例来看待。</p>
</blockquote>
<p><br></p>
<p>独立(Independent):Imagine that this coin lands on heads with probability 2/3, and tails with probability 1/3. If we flip the coin twice, the outcome of the first coin flip will not the change the outcome of the second.</p>
<p>同分布(Identically Distributed):When the coin was flipped the first time, the probability of either getting heads or tail was 2/3, and 1/3 respectively. When the coin is flipped the second time, the probability of actually getting either heads or tails is still 2/3, and 1/3. The probability that you get either heads or tails after the first flip doesn’t change. </p>
<p>大数定理(Law of Large Nunbers, LLN):The idea that the sample mean converges in value and probability to the expected value as the sample size increases.</p>
<p>大数定理实例解读: … If you toss a coin 10 times, what is the probability that you get 5 heads? This can actually be computed analytically using the binomial distribution:</p>
<p>$$ \left( \begin{array}{cr} 10 \ 5 \end{array} \right) \left( { 1 \over 2 }\right)^5 \left(1 - {1\over 2}\right)^5 = 0.2461.$$</p>
<p>But if you now consider 100 trials, the probability becomes:</p>
<p>$$\left( \begin{array}{cr} 100 \ 50 \end{array} \right) \left( { 1 \over 2 }\right)^{50} \left(1 - {1\over 2}\right)^{50} = 0.0796.$$</p>
<p>The higher the number of trials, the smaller the probability of getting exactly N/2 number of heads. … however as mentioned before, interestingly the probability to get exactly N/2 heads gets smaller.Let’s for example calculate the probability that we can any number of heads between 40 and 60 for 100 trials:</p>
<p>$$Pr(40 \leq X \leq 60) = \sum_{i=40}^{60} C^i_{100} \left( \dfrac{1}{2} \right)^i \left( 1 - \dfrac{1}{2} \right)^{100 -i} = 0.9648.$$</p>
<p>However, if we compute the probability of getting any number of heads in the interval [4,6] for 10 trials, then we get:</p>
<p>$$Pr(4 \leq X \leq 6) = \sum_{i=4}^{6} C^i_{10} \left( \dfrac{1}{2} \right)^i \left( 1 - \dfrac{1}{2} \right)^{10 -i} = 0.6563.$$</p>
<p>Clearly, the probability of getting close to 1/2 increases as the number of trials increases.</p>
<blockquote>
<p>想象一下丢了N次色子最后的次数分布图为正态分布，那么当总次数变为10次时，就可以理解为采样间隔非常大或者是采样频率更低，总次数不足，因此单个事件(比如5次)发生的概率就远远比采样频率更高的$C^{5}_{10}$要大的多。</p>
</blockquote>
<blockquote>
<p>但倘若取采样间隔$[40, 60]$以及$[4, 6]$就可以明显发现，在采样频率更高的前提下，最终的概率会越来越趋近于$\frac{1}{2}$附近。</p>
</blockquote>
<blockquote>
<p>对比连续型随机变量，事实上当采样频率趋于无穷大$f \to \infty$，连续性随机变量概率函数$PDF(x) = 0$(事实上其概率密度函数的定义就是$PDF(a&lt;x&lt;b) = \int^b_a f(x)dx$，这也被记为$X \sim f(x)$)，所以当离散型随机变量的采样频率不断增加，也就是大数定理反应的，其单一事件发生的概率也会不断趋近于0。</p>
</blockquote>
<p>结论(Conclusion):the sample mean $\bar{X}$ of a random sample always converge in probability to the population mean $μ$ of the population from which the random sample was taken … If we know the distribution of the random variable we can compute the expected value directly</p>
<p>$$E[X] = \sum_{i=1} p_i x_i \rightarrow = \sum_{\omega \in S} X(\omega) p(\omega).$$</p>
<blockquote>
<p>事实上当写下$E[X_1]$的时候，此时$X_1$只是随机变量的一个取值，他可以是任何值，但是其期望$E[X_1]$是固定的，这对随机变量的所有取值而言都一样$E[X_1] = E[X_2] = E[X_3]… = E[X_n]$。原因很简单，因为这些随机变量的取值都共有一个概率密度函数。</p>
</blockquote>
<hr>
<h3 id="Properties-of-Expectations"><a href="#Properties-of-Expectations" class="headerlink" title="Properties of Expectations"></a>Properties of Expectations</h3><ol>
<li><p>若$Y = aX + b​$，那么$E[Y] = aE[X] +b​$。考虑一下当抛掷的色子的号码同时增加b的时候，那么期望值也会随之增加b。</p>
<p>$$\begin{array}{l}</p>
<p>E[aX] &amp;=&amp; \sum_i a x_i P(X = x_i) \\</p>
<p>&amp;=&amp;a \sum_i x_i P(X = x_i)\ </p>
<p>&amp;=&amp;aE[X].</p>
<p>\end{array}$$</p>
</li>
<li><p>随机变量和的期望等价于每个随机变量期望的和</p>
<p>$$E[X_1 + … X_n] = E[X_1] + … + E[X_n].​$$</p>
</li>
</ol>
<p>X+Y的期望可以按照如下表达</p>
<p>$$\begin{array}{l}</p>
<p>E[X + Y] &amp;=&amp;\sum_i \sum_j (x_i + y_j) Pr(X = x_i, Y = y_i) \ </p>
<p>&amp; = &amp; \sum_i \sum_j x_i Pr(X = x_i, Y = y_i) +  \sum_i \sum_j y_j Pr(X = x_i, Y = y_i) \ </p>
<p>&amp; = &amp; \sum_j y_j Pr(Y = y_j) + \sum_i x_i Pr(X = x_i)  \\</p>
<p>&amp;=&amp;E[Y] + E[X].</p>
<p>\end{array}$$</p>
<p>这里Y的概率已经被求和为1省略，X同理</p>
<p>$$\sum_j Pr(X = x_i, Y = y_j) = Pr(X = x_i),$$</p>
<p>$$\sum_i Pr(X = x_i, Y = y_j) = Pr(Y = y_j).$$</p>
<blockquote>
<p>可以这样解读概率1的由来</p>
</blockquote>
<p>$$\begin{array}{l} </p>
<p>\sum_j Pr(X = x_i, Y = y_j) &amp; = &amp; \sum_j Pr(X = x_i) * Pr(Y = y_j) \\</p>
<p>&amp; = &amp; Pr(X = x_i) \sum_j Pr(Y = y_j) \\</p>
<p>&amp; = &amp; Pr(X = x_i) * 1 \\</p>
<p>&amp; = &amp; Pr(X = x_i)</p>
<p>\end{array}</p>
<p>$$</p>
<p>这里$Pr(X = x_i, Y = y_j)$就是代表当$X$和$Y$同时发生的概率，可以使用乘法守则来解决</p>

                      </p>
                    </div>
                  </div>
                  <br>
                  <br>
                  
                  <div class="card is-white is-hover" id="articleCard">
                    <div class="card-header">
                      <a href="/2018/03/12/2016-1-23-Unreal Engine Rendering Overview/" class="card-header-title">
                        Unreal Engine Rendering Overview
                      </a>
                    </div>
                    <div class="card-content">
                      <p id="articleContent">
                        <blockquote>
<p>本文源于<a href="https://docs.unrealengine.com/latest/INT/Engine/Rendering/Overview/index.html" target="_blank" rel="noopener">Unreal官方Rendering Overview</a>的基本概念理解和翻译</p>
</blockquote>
<h3 id="延迟渲染"><a href="#延迟渲染" class="headerlink" title="延迟渲染"></a>延迟渲染</h3><p>与Unreal Engine 3中的Forward Lighting Path不同的是，Unreal Engine 4中所有的光源都采用的是延迟渲染的技术。各种材质都会讲各自的属性写入GBuffers当中，因此在根据光源计算时，光源直接通过Buffer上的per-pixel的材质属性来计算光照。</p>
<blockquote>
<p>Forward Lighting Path本质上就是最传统的光源场景渲染方式，二者对比可见<a href="http://gamedevelopment.tutsplus.com/articles/forward-rendering-vs-deferred-rendering--gamedev-12342" target="_blank" rel="noopener">Forward Rendering vs. Deferred Rendering</a>。当在指定渲染目标时，前者的做法是对场景中的每一个几何体都对每个光源进行一次管线中的光照计算，最后直接着色叠加。</p>
<p>后者为先行计算四张2D Image/Buffer(<strong>Screen Space Depth</strong>,<strong>Surface Normals</strong>,<strong>Diffuse Color</strong>,<strong>Specular color and specular power</strong>)，VS中计算各图所需的几何体信息，而PS只存图，之后每个光源才与四张图上的内容进行着色计算。</p>
</blockquote>
<blockquote>
<p>总结而言 Forward Lighting Path的伪代码</p>
</blockquote>
<pre><code class="cpp">
for each object

   for each light

     shading

</code></pre>
<blockquote>
<p>Deffered Shading</p>
</blockquote>
<pre><code class="cpp">
for each pixel

   for each light

     shading

</code></pre>
<figure><br>    <a href="https://cdn.tutsplus.com/gamedev/uploads/2013/11/forward-v2.png" target="_blank" rel="noopener"><br>        <img src="https://cdn.tutsplus.com/gamedev/uploads/2013/11/forward-v2.png" alt=""><br>    </a><br></figure>

<blockquote>
<p>Forward Rendering Path</p>
</blockquote>
<figure><br>    <a href="https://cdn.tutsplus.com/gamedev/uploads/2013/11/deferred-v2.png" target="_blank" rel="noopener"><br>        <img src="https://cdn.tutsplus.com/gamedev/uploads/2013/11/deferred-v2.png" alt=""><br>    </a><br></figure>

<blockquote>
<p>Deffered Shading</p>
<p>不过延迟渲染也不是完美的，在比较小的场景下延迟渲染会明显增加显存消耗和渲染速度下降，所以比较适合于较大型场景。另一个缺点是，延迟渲染对待多着色模型的场景是比较吃力。(感谢<a href="http://lonelywaiting.github.io/" target="_blank" rel="noopener">孤独的守候</a>的知识分享)</p>
</blockquote>
<p><br></p>
<h3 id="Lighting-Paths"><a href="#Lighting-Paths" class="headerlink" title="Lighting Paths"></a>Lighting Paths</h3><p>UE4中有三种不同的光源</p>
<ul>
<li>全动态光源(详见<a href="https://docs.unrealengine.com/latest/INT/Engine/Rendering/LightingAndShadows/LightMobility/DynamicLights/index.html" target="_blank" rel="noopener">Fully dynamic</a>)</li>
<li>半静态光源(详见<a href="https://docs.unrealengine.com/latest/INT/Engine/Rendering/Overview/index.html" target="_blank" rel="noopener">Partially static</a>)</li>
<li>全静态光源(<a href="https://docs.unrealengine.com/latest/INT/Engine/Rendering/Overview/index.html" target="_blank" rel="noopener">Fully static</a>)</li>
</ul>
<p>这些光源的使用场景也是根据不同的游戏场景，不同的性能品质要求会需要的权衡。每个游戏都还为自己选用最合适的光源类型。</p>
<blockquote>
<p>Movable Lights: 在运行期间可以改变位置，旋转朝向，改变颜色，亮度，衰退因子，半径等任何光源拥有的属性都可以动态修改。因此这些光源不会预先烘焙光照贴图，也不会产生任何的间接光照(实时渲染中间接光照一般都是预计算完成)。</p>
<p>Static Lights: 静止光源的位置是不可以改变的，但是光源的亮度和颜色等都可以随之改变，因此这也是与静态光源有着最大差异的地方。但是其所改变的光源的属性都只会影响直接光照，间接光照都是由<a href="https://docs.unrealengine.com/latest/INT/Engine/Rendering/LightingAndShadows/Lightmass/index.html" target="_blank" rel="noopener">Lightmass</a>预计算的，因此运行时改变其值也不会影响。</p>
<p>Stationary lights:静态光源是不能在运行时改变任何属性的光源，他们会在Lightmass中计算完毕，之后不会对性能造成任何过多的影响。因此他是三者当中拥有中等效果，较低的可更改性但也是性能最友好的一个光源类型。</p>
</blockquote>
<p><br></p>
<h3 id="Lit-Translucency"><a href="#Lit-Translucency" class="headerlink" title="Lit Translucency"></a>Lit Translucency</h3><figure><br>    <a href="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/self_shadow_1.jpg" target="_blank" rel="noopener"><br>        <img src="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/self_shadow_1.jpg" alt=""><br>    </a><br></figure>

<p>以及</p>
<figure><br>    <a href="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/self_shadow_2.jpg" target="_blank" rel="noopener"><br>        <img src="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/self_shadow_2.jpg" alt=""><br>    </a><br></figure>

<p>半透明材质的发光以及着色是在单一的光源前进传递(Single Forward Pass)中保证其正确性的，但是在多通道的光源下并不适用的技术。</p>
<p>半透明材质可以向非透明物体上投射阴影，也可以向自身或者其他半透明材质上投射阴影(如图所示)</p>
<p><br></p>
<h3 id="Sub-Surface-Shading"><a href="#Sub-Surface-Shading" class="headerlink" title="Sub-Surface Shading"></a>Sub-Surface Shading</h3><figure><br>    <a href="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/jade_statue.jpg" target="_blank" rel="noopener"><br>        <img src="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/jade_statue.jpg" alt=""><br>    </a><br></figure>

<p>Jade Material</p>
<figure><br>    <a href="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/ice_mounds.jpg" target="_blank" rel="noopener"><br>        <img src="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/ice_mounds.jpg" alt=""><br>    </a><br></figure>

<p>Ice Material</p>
<p>次表面散射着色模型是为了用于模拟蜡烛，玉制物体而做的新着色模型。他们并不是完全的半透明，但会在内部散射入射进来的光。这会比实现皮肤渲染上质量稍低但开销更小。</p>
<p><br></p>
<h3 id="GPU-Particles"><a href="#GPU-Particles" class="headerlink" title="GPU Particles"></a>GPU Particles</h3><p>UE4支持在GPU上模拟粒子效果，传统的CPU难以完成的上千种粒子效果可以在GPU内更快效果更好的实现。</p>
<p><br></p>
<h3 id="Vector-Fields"><a href="#Vector-Fields" class="headerlink" title="Vector Fields"></a>Vector Fields</h3><p>在GPU粒子中最有趣的一项特性莫过于向量场了，一个向量场是在一个网格中均匀影响所在其中粒子运动的一个向量集，向量场在UE4中是作为一个Actors来出现的，因此他本身也可以像其他Actors一样被位移，旋转，或者是缩放，所以在运行期间他们都是可以被动态移动的。</p>
<figure><br>    <a href="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/vector_field_global.jpg" target="_blank" rel="noopener"><br>        <img src="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/vector_field_global.jpg" alt=""><br>    </a><br></figure>

<p>例如一个向量场可以被放置在瀑布上，当粒子进入了向量场的边界时，他们都会被其所影响，当粒子群离开了边界其作用的效果也会淡去(fade out)。</p>
<p><br></p>
<h3 id="后期特效"><a href="#后期特效" class="headerlink" title="后期特效"></a>后期特效</h3><ul>
<li><p>环境光遮蔽(Ambient Occlusion): 目前使用的环境光遮蔽为SSAO(屏幕空间环境光遮蔽，Screen Space Ambient Occlusion)，只会依赖与深度缓存。所以也不会被细节法线贴图或者Smoothing groups影响。因此在一些面元较少的多边形上开启这个效果时，就会显得非常生硬。所以UE4只会在选项<strong>AmbientCubemap</strong>上开启这个效果。</p>
</li>
<li><p>环境光立方体贴图(Ambient Cubemaps): 该效果对整个场景中的光照采用一立方体贴图，所以这个效果也是与当前材质所在位置是互相独立的。贴图的计算需要用到观察者的位置，材质的粗糙度(镜面反射效果),以及当前材质的面法线。这也就带来了高质量高效的环境光实现。</p>
</li>
<li><p>镜头高光(Bloom): 高光是真实世界光照的现象，较低的渲染开销却可以带来非常好的感官真实度的提升。高光效果一般可以在非常暗的背景中裸眼观察非常亮的物体观测到。</p>
</li>
</ul>
<figure><br>    <a href="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/lens_flare.jpg" target="_blank" rel="noopener"><br>        <img src="https://docs.unrealengine.com/latest/images/Engine/Rendering/Overview/lens_flare.jpg" alt=""><br>    </a><br></figure>

<ul>
<li><p>人眼适应:可以会自动调整场景的曝光度，重现从明亮环境进入黑暗环境（或相反）时所经历的效果。</p>
</li>
<li><p>镜头眩光:会在镜头转向明亮物体时自动产生镜头的眩光效果。</p>
</li>
<li><p>色调映射(Tone Mapping):使得渲染场景的颜色可以被转换或修改来得到不同的效果。这可以被用来制作诸如棕褐滤镜，或击中特效（例如红色闪光）等。</p>
</li>
</ul>

                      </p>
                    </div>
                  </div>
                  <br>
                  <br>
                  
                  <div class="card is-white is-hover" id="articleCard">
                    <div class="card-header">
                      <a href="/2018/03/12/2016-1-20-Path Tracing Notes 1/" class="card-header-title">
                        Path Tracing Notes 1
                      </a>
                    </div>
                    <div class="card-content">
                      <p id="articleContent">
                        <h3 id="Diffuse-Reflection"><a href="#Diffuse-Reflection" class="headerlink" title="Diffuse Reflection"></a>Diffuse Reflection</h3><blockquote>
<p>以下笔记为读<a href="http://blog.hvidtfeldts.net/media/pt2.jpg" target="_blank" rel="noopener">Syntopia</a>后感，解决了不少概念上以及实际应用上的疑难点</p>
</blockquote>
<p>入射光与表面法线夹角</p>
<p>$$cos\theta = \vec{n}·\vec{l}$$</p>
<p><br></p>
<p>出射光辐射度计算</p>
<p>$$L_{out}(\vec{w_o}) = \int{K * L_{in}(\vec{w_i}) cos\theta} d\vec{w_i}$$</p>
<blockquote>
<p>漫反射模型在表面上，任意方向进入的光其反射方向都为随机，因此在给定指定出射方向上的辐射度求解时需要对当前点的整个半球方向上的入射光进行考虑，因为所有光都有可能在这个方向上出射。</p>
<p>这里的常数K本质上「就是决定了多少入射辐射度会在给定方向out上出去」，这里基于能量守恒的定义$\int{Kcos\theta d\vec{w_i} \le 1}$，也就是出射辐射度绝不会大于入射辐射度。</p>
<p>简单的计算过后，也能发现$K \le \frac{1}{\pi}$</p>
</blockquote>
<p>漫反射模型当中，反照率$albedo = K\pi$，当然在基于物理的材质模型下albedo始终处于[0, 1]区间当中，也就是满足能量守恒。</p>
<p><br></p>
<p>漫反射模型的渲染方程的定义可以改为如下形式</p>
<p>$$L_{out}(\vec{w_o}) = \int{\frac{albedo}{\pi}*L_{in}(\vec{w_i})cos\theta d\vec{w_i}}$$</p>
<p>但漫反射模型的K因子无非是下列中通用BRDF形式的渲染方程</p>
<p>$$L_{out}(\vec{w_o}) = \int{BRDF(\vec{w_i}, \vec{w_o})*L_{in}(\vec{w_i})cos\theta d\vec{w_i}}$$</p>
<p>为了计算上述的无穷积分，也就可以引入Monte Carlo Sampling。本质上就是为了求取一个积分的估计量，可以采用不断提升采样数量并求取平均来解决</p>
<p>$$\int_a^b f(x) dx \approx{\frac{b-a}{N}\sum^N_{i=1}f(X_i)}$$</p>
<p>将此应用到漫反射模型上</p>
<blockquote>
<p>也就是替换$BRDF(\vec{w_i, \vec{w_o}})$为反照率albedo形式，$cos\theta$可以替换为方向向量点积</p>
</blockquote>
<p>$$L_{out}(\vec{w_o}) = \int{\frac{albedo}{\pi}*L_{in}(\vec{w_i})cos\theta d\vec{w_i}}$$</p>
<p>$$ = \frac{2\pi}{N}\sum_{\vec{w_i}}(\frac{albedo}{\pi})L_{in}(\vec{n}·\vec{w_i})$$</p>
<p>$$ = \frac{2·albedo}{N} \sum_{\vec{w_i}}(\vec{n}·\vec{w_i})$$</p>
<p><br></p>
<h3 id="Importance-Sampling"><a href="#Importance-Sampling" class="headerlink" title="Importance Sampling"></a>Importance Sampling</h3><p>介于$cos\theta$也就是$(\vec{n}·\vec{w_i})$这样的因子，入射光在靠近法线方向上贡献给反射光的辐射度将会更大。</p>
<blockquote>
<p>根据Monte Carlo Sampling的样式定义，为求取积分近似值，我们需要将$f(X_i)$除以PDF(probability density function， 概率密度函数)</p>
</blockquote>
<p>PDF与给定求取积分的函数f(x)越成比例，那么理论上说该积分求取收敛的也就会越快。这里f(x)本质上成比例与$cos\theta$，那么配合上能量守恒可以将PDF定义为</p>
<p>$$PDF = \frac{cos\theta}{2\pi}$$</p>
<p>最终积分近似求解的表达式也就可以简化掉$cos\theta$部分</p>
<h3 id="Direct-Lighting-Next-Event-Estimation"><a href="#Direct-Lighting-Next-Event-Estimation" class="headerlink" title="Direct Lighting / Next Event Estimation"></a>Direct Lighting / Next Event Estimation</h3><blockquote>
<p>原先笔者在视频教学中了解到这一项优化技术，以为Next Event Estimation是一个比较小众的优化方式，配合上Advanced Global Illumination以及PBRT，这才明白其实Next Event Estimation本质上就是Direct Lighting，是一个非常常见的高效利用光线的方式。</p>
<p>很常见的方式是讲理想的面光源换为环境贴图，这样能够极大的改善光线利用率</p>
</blockquote>
<p>Path tracing的方式本质上就是光线从摄像头发出，在场景中弹跳直到遇到光源为止。这里的关键就在于要遇到光源。</p>
<p>这里最重要的部分就是光源的面积，理想中的点光源在Path traing中得到的画面通常是一篇全黑，因为光线击中点光源的概率为0。粗劣的计算一下一个简单的场景:</p>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Angular_diameter" target="_blank" rel="noopener">角直径</a>(angular diameter)科普，是用于描述从给定视点上观测一个球或者圆形的观测大小，也被成为视角(visual angle)。</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/4/49/Angular_dia_formula.JPG" alt="如图所示"></p>
</blockquote>
<p>太阳的角直径大约为32弧分，也就是大约0.5度左右，其立体角(solid angle)</p>
<p>$$\Omega = 2\pi(1-cos\theta)$$</p>
<p>因此粗略得出太阳大约覆盖了$6*10^{-5}$立体弧度或者$\frac{1}{100000}$的半球表面，所以即便是采用接近70000个采样点，半球也不过只有$1-(1-10^{-5})^{70000} = 50\%$的几率能够捕捉到太阳光线(换句话说就是发射的光线50%几率能够击中太阳)。</p>
<p><br></p>
<p>Direct Lighting本质上是重要性采样的直观实践。在每次光线击中表面时我们都向已知光源发射一根光线手动获取其光亮度(当然当真正击中光源时我们将他的权值定为0，因为光源已经在先前部分有了贡献)。</p>

                      </p>
                    </div>
                  </div>
                  <br>
                  <br>
                  
                  <div class="card is-white is-hover" id="articleCard">
                    <div class="card-header">
                      <a href="/2018/03/12/2015-12-16-Ray Tracing Notes 2/" class="card-header-title">
                        Ray Tracing Notes 2
                      </a>
                    </div>
                    <div class="card-content">
                      <p id="articleContent">
                        <blockquote>
<p>此篇的内容为观看<a href="https://www.youtube.com/watch?v=4gXPVoippTs&amp;list=PLujxSBD-JXgnGmsn7gEyN28P1DnRZG7qi&amp;index=3" target="_blank" rel="noopener">Ray Tracing Course</a>多遍后并结合部分<a href="www.pbrt.org">PBRT</a>原文的笔记内容</p>
</blockquote>
<h2 id="Radiometry"><a href="#Radiometry" class="headerlink" title="Radiometry"></a>Radiometry</h2><p>Radiant Flux</p>
<p>$$\phi ~ [W] / [J/s]$$</p>
<p>之所以不使用辐射通量的原因是因为我们无法分辨究竟：「大量的能量穿过了一个小面积区域」or 「较少的能量穿过了一个大面积区域」（这里能量的多少指代平均面积上能量的分布）</p>
<p>Irradiance</p>
<p>$$E ~ [W / m^2]$$</p>
<blockquote>
<p>又称入射辐射面密度</p>
</blockquote>
<p>不使用辐照度的原因是，无法分辨:「大量能量的入射角较大」or「少量能量的入射角较小」情况</p>
<p>Radiance</p>
<p>$$L ~ [W / m^2 · sr]$$</p>
<blockquote>
<p>sr表示单位角，在更高纬度的情况而言，又称为solid angle，单位为立体弧度</p>
</blockquote>
<p><br></p>
<h2 id="BRDF"><a href="#BRDF" class="headerlink" title="BRDF"></a>BRDF</h2><p>$$<br>f_r(p, \omega_o, \omega_i) = \frac{dL_o(p, \omega_o)}{dE(p, \omega_i)} =  \frac{dL_o(p, \omega_o)}{L_i(p, \omega_i)\cos\theta_id \omega_i}<br>$$</p>
<blockquote>
<p>本质上BRDF就是用来描述「有多少从$w_i$方向入射的光从方向$w_o$上反射出去的函数」</p>
</blockquote>
<p>BRDF个人觉得可以多层次解读，首先，BRDF讲解了入射光和反射光的概率密度分布，因为他本质上只是一个入射辐射度和出射辐射度的比例（也就是返回值）;另一个角度而言，在给定了入射方向$w_i$时，BRDF也负责计算出射方向$w_o$的概率。</p>
<p><br></p>
<h2 id="Fresnel’s-law-Snell’s-Law"><a href="#Fresnel’s-law-Snell’s-Law" class="headerlink" title="Fresnel’s law + Snell’s Law"></a>Fresnel’s law + Snell’s Law</h2><blockquote>
<p>菲涅尔公式的作用是计算入射光时，发生反射和折射的概率计算，也可以被认为是入射光能量分布情况，而斯奈尔法则则是确定入射光之后的折射光和反射光角度计算</p>
</blockquote>
<p>Snell’s Law中展示出的全反射现象，只会出现在光从光疏介质到光密介质的情况下下。</p>
<p><br></p>
<h2 id="Surface-Normal"><a href="#Surface-Normal" class="headerlink" title="Surface Normal"></a>Surface Normal</h2><p>面法线的计算本质上就是求解给定曲面指定点上的梯度$\nabla f(x, y) = 0$，给定双曲面$f(x, y, z) = \frac{x^2}{a^2} + \frac{y^2}{b^2} - z$，其中$a, b$为给定的双曲面的曲率，因此给定点$(x, y, z)$求解面法线，$\nabla f(x, y ,z) = (\frac{2x}{a^2}, \frac{2y}{b^2}, -z)$就是所求梯度。</p>
<p><br></p>
<h2 id="F-Stop"><a href="#F-Stop" class="headerlink" title="F-Stop"></a>F-Stop</h2><blockquote>
<p>对于焦比的科普可以参考<a href="https://www.youtube.com/watch?v=KmNIouLByJQ" target="_blank" rel="noopener">A Simple Explanation of F-Stop</a></p>
</blockquote>
<p>本质上从光学上理解，景深的就是因为快门的开关之间进光量的多少造成的。因此例如视频中讲解的$\frac{Focal}{x} = Diameter$,实际单反的$f/1.4$之类的写法本质上就是用于给出光圈大小。</p>
<p>但因为同样的光圈大小也可能因为焦距不同导致进光量有所不同，因此不直接给出$Diameter$的具体值，而是给出类似$f/2.0$之类的写法。</p>
<p>而进光量越大，通过透镜的光子也就越多，非焦距上的物体边缘也就显得越模糊，换一种说法就是用于描述非焦距上的物体的光子也就越多。</p>
<p><br></p>
<h2 id="Monte-Carlo-Integration"><a href="#Monte-Carlo-Integration" class="headerlink" title="Monte Carlo Integration"></a>Monte Carlo Integration</h2><p>$$<br>E_N[f(x)] = \int^b_a f(x)p(x)dx = \lim_{N \to \infty}\frac{b-a}{N}\sum^N_{i=1}f(X_i)<br>$$</p>
<blockquote>
<p>X代表在$f(x)$上的N个随机采样，记为$X_i$</p>
</blockquote>
<p>因此本质上使用无意识的统计规律算法，对与原始的$\int_a^bf(x)dx$进行变换(可见PBRT)</p>
<p>$$<br>\int^b_af(x)dx = \int^b_a\frac{f(x)}{p(x)}p(x)dx = E[\frac{f(x)}{p(x)}] = \frac{1}{N}\sum^N_{i=1}\frac{f(X_i)}{p(X_i)}<br>$$</p>
<p><br></p>
<h2 id="Importance-Sampling"><a href="#Importance-Sampling" class="headerlink" title="Importance Sampling"></a>Importance Sampling</h2><p>最佳的重要性采样(最小的方差)，就是函数$f(x)$上的每一个采样点的采样概率，都与其函数值成比例即可($p(X_i) \propto f(X_i)$)</p>
<blockquote>
<p>因此一个较佳的$p(\vec{w_i’})$本质上就是与被积函数成比例的函数，如若选择一个均匀概率分布函数，那么就是非重要性采样和重要性采样之间的差距了</p>
</blockquote>
<p>例如 $p(\vec{w_i}’) = \frac{cos\theta}{\pi}$，简化渲染方程的计算(BRDF采用最简单的漫反射模型$f_r(p, w_i, w_o) = \frac{\rho}{\pi}$.</p>
<p>$$<br>\frac{1}{N}\sum^N_{i=1}\frac{L_i(x, \vec{w_i}’)\rho/\pi cos\theta}{cos\theta/\pi} = \frac{1}{N}\sum^N_{i=1}L_i(x, \vec{w_i}’)\rho<br>$$</p>
<p><br></p>
<p><img src="https://farm1.staticflickr.com/575/23744227676_e4fd679f8d_o.jpg" width="1002" height="798" alt="cornell_box___spheres_in_cycles_ii_by_elbrujodelatribu-d5l59e0"></p>
<blockquote>
<p>配图为康奈尔盒</p>
</blockquote>

                      </p>
                    </div>
                  </div>
                  <br>
                  <br>
                  
              
          </div>
        </div>
      </div>
      <!-- about me -->
      <div class="column">
        <div class="card is-white is-hover is-hidden-mobile is-sticky">
          <div class="card-image">
            <figure class="image">
              <img src="http://pbrt.org/gallery/a3.jpg">
            </figure>
          </div>
          <div class="card-content">
            <div class="media">
              <div class="media-left">
                <figure class="image is-48x48">
                  <img src="https://github.com/BentleyBlanks.png">
                </figure>
              </div>
              <div class="media-content">
                <p class="title is-4">Bingo</p>
                <p class="subtitle is-6">@BentleyJobs</p>
              </div>
            </div>
            <div class="content">
              Graduated from <a href="https://www.jiangnan.edu.cn/">JNU</a>, interested in cg & game developing, once worked in <a href="https://www.aurogon.com/">Aurogon</a> to develope <a href="https://gjol.yy.com/">GuJianOL</a>. See <a href="">about</a> for more info.
            </div>
            <!-- icon link -->
            <div class="level is-mobile" id="iconLink">
              <!-- <div class="column"></div> -->

              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-map-marker" href="https://www.google.com/maps/place/Ningbo,+Zhejiang,+China/@29.8694844,121.2917787,10z/data=!3m1!4b1!4m5!3m4!1s0x344d6354630858f7:0x948723f846ccf173!8m2!3d29.868336!4d121.54399"></a>
              </div>
              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-github" href="https://github.com/BentleyBlanks/"></a>
              </div>
              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-envelope" href="mailto:bentleyjobs@gmail.com?subject=Hello%20again"></a>
              </div>
              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-weibo" href="https://weibo.com/2162074794"></a>
              </div>

              <!-- <div class="column"></div> -->
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="column"></div> -->
    </div>
  </div>
</section>

<div class="pagination-bar">
    <ul class="pagination">
        
        <li class="pagination-prev">
            
                <a class="btn btn--default btn--small" href="/archives/2018/page/5/">
            
                <i class="fa fa-angle-left text-base icon-mr"></i>
                    <span>pagination.newer_posts</span>
            </a>
        </li>
        
        
        <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/archives/2018/page/7/">
                    <span>pagination.older_posts</span>
                <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
        </li>
        
        <li class="pagination-number">pagination.page pagination.of</li>
    </ul>
</div>



<!-- Footer -->
<footer class="footer is-medium" id="footerStyle">
  <div class="container">
    <nav class="level is-mobile">
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>

      <div class="level-item has-text-centered">
        <img src="https://yellowdi.github.io/Elenore/images/elenore-icon-outlined.png" alt="Elenore logo" width="50">
      </div>

      <div class="level-item has-text-centered">
        <img src="https://raw.githubusercontent.com/hexojs/logo/master/hexo-logo-avatar-transparent-background.png" alt="Hexo logo" width="50">
      </div>
      
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
    </nav>

    <div class="columns has-text-centered">
      <div class="column">
        Theme Floekr developed By <a href="https://github.com/BentleyBlanks">Bingo</a>, powered by <a href="https://yellowdi.github.io/Elenore">Elenore</a> and <a href="https://hexo.io/">Hexo</a>
      </div>
    </div>

  </div>
</footer>


  <!-- scripts list from theme config.yml -->
  
    <script src="/js/floekr.js" language="javascript"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  

</body>
</html>
