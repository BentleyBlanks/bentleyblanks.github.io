


<!DOCTYPE html>
<html lang="">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
  <!-- responsive-->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Archives: 3/2018: 2018 [ Bingo ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/elenore/css/elenore.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="/css/floekr.css">
    
  

  <!-- highlight -->
  <link rel="stylesheet" href="/highlight/styles/monokai-sublime.css">
  <script src="/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>
<body>

<!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Navigation Bar -->
<nav id="navbar" class="navbar is-white is-fixed-top">
  <div id="specialShadow" class="el-special-shadow"></div>
  <div class="container">

    <!-- left side, always visible -->
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <!-- <strong>Bingo</strong> -->
        <i class="fa fa-lg fa-home"></i>
      </a>

      <!-- toggles the menu on touch devices -->
      <div id="navbarBurger" class="navbar-burger burger" data-target="navMenu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <!-- menu -->
    <div id="navMenu" class="navbar-menu">
        <div class="navbar-end">
          
            
            <a href="/" class="navbar-item">HOME</a>
            

            

            
          
            

            

            
            <a href="/projects" class="navbar-item" >PROJECTS</a>
            
          
            

            
            <a href="/about" class="navbar-item">ABOUT</a>
            

            
          
        </div>
    </div>
  </div>
</nav>

<!-- index hero -->
<div class="hero is-large has-background-fixed" id="indexHero">
  <div class="hero-body">
    <div class="container has-text-centered">
      <p id="titleContent">
        Bingo, <span>Computer Graphics</span> & <span>Game Developer</span>
      </p>
    </div>
  </div>
</div>

<!-- articles and about me -->

<section class="section">
  <div class="container">
    <!-- content and about me -->
    <div class="columns">
      <!-- blog -->
      <div class="column is-two-thirds">
        <div class="columns is-multiline">
          <div class="column is-12">
            <!-- articles -->
            
                
                  <div class="card is-white is-hover" id="articleCard">
                    <div class="card-header">
                      <a href="/2018/03/12/2017-07-09-Atmos坐标变换/" class="card-header-title">
                        Atmos坐标变换
                      </a>
                    </div>
                    <div class="card-content">
                      <p id="articleContent">
                        <h3 id="坐标变换"><a href="#坐标变换" class="headerlink" title="坐标变换"></a>坐标变换</h3><blockquote>
<p>通常摄像机动画，模型动画中会使用旋转平移变换来完成坐标变换。这里使用基变换来完成通用的坐标系转换。</p>
</blockquote>
<p>现要求得世界坐标$P_{world}$对应的代求坐标系$\Omega$下坐标$P_{\Omega}$，已知$\Omega$坐标轴向量分别为$\overset{\rightharpoonup}{X}, \overset{\rightharpoonup}{Y}, \overset{\rightharpoonup}{Z}$,坐标原点为$O$</p>
<p>$$worldToObject<br>\left(<br>\begin{matrix}<br>\overset{\rightharpoonup}{X}.x &amp; \overset{\rightharpoonup}{Y}.x &amp; \overset{\rightharpoonup}{Z}.x &amp; O.x \ <br>\overset{\rightharpoonup}{X}.x &amp; \overset{\rightharpoonup}{Y}.y &amp; \overset{\rightharpoonup}{Z}.y &amp; O.y \\<br>\overset{\rightharpoonup}{X}.z &amp; \overset{\rightharpoonup}{Y}.z &amp; \overset{\rightharpoonup}{Z}.z &amp; O.z \\<br>0 &amp; 0 &amp; 0 &amp; 1<br>\end{matrix}<br>\right)$$</p>
<p>即有$P_{\Omega}=worldToObject * P_{world}$.(该矩阵含义可展开其含义自明)</p>
<h3 id="PBRT以及Atmos中关于相机各类坐标系的转换"><a href="#PBRT以及Atmos中关于相机各类坐标系的转换" class="headerlink" title="PBRT以及Atmos中关于相机各类坐标系的转换"></a>PBRT以及Atmos中关于相机各类坐标系的转换</h3><blockquote>
<p>PBRT中的NDC坐标系在Atmos中未使用，因为其本身在PBRT中并不直接体现</p>
</blockquote>
<p>具体的转换管线流程如下，实现公式可由下图各自推导出来，不做赘述。</p>
<pre><code class="cpp">rasterPosition(imageX, imageY);

// raster to screen
screenPosition(rasterPosition.x - image-&gt;width / 2.0f, -rasterPosition.y + image-&gt;height / 2.0f);

// screen to camera
// 这里pbrt中使用投影矩阵的逆变换得到cameraPos，不过由于透视的特殊性，其方向向量是一致的。
cameraPosition.x = 2 * canvasSize.x * screenPosition.x / image-&gt;width;
cameraPosition.y = 2 * canvasSize.y * screenPosition.y / image-&gt;height;
cameraPosition.z = canvasDistance;

// camera to world
ray-&gt;direction = (cameraToWorld * cameraPosition).getNormalized();
ray-&gt;origin = cameraToWorld * zeroVector3;
</code></pre>
<p><img src="https://farm5.staticflickr.com/4264/35005454923_f05e8118e1_b.jpg" alt=""></p>
<p>之后可以用worldToCamera矩阵进行转换。</p>
<p>$$worldToCamera<br>\left(<br>\begin{matrix}<br>right.x &amp; up.x &amp; direction.x &amp; origin.x \ <br>right.x &amp; up.y &amp; direction.y &amp; origin.y \\<br>right.z &amp; up.z &amp; direction.z &amp; origin.z \\<br>0 &amp; 0 &amp; 0 &amp; 1<br>\end{matrix}<br>\right)$$</p>

                      </p>
                    </div>
                  </div>
                  <br>
                  <br>
                  
                  <div class="card is-white is-hover" id="articleCard">
                    <div class="card-header">
                      <a href="/2018/03/12/2017-03-27-Transformation In Multiple Dimensions/" class="card-header-title">
                        Transformation In Multiple Dimensions
                      </a>
                    </div>
                    <div class="card-content">
                      <p id="articleContent">
                        <blockquote>
<p>本文运用上文中多维随机变量分布转换规律，来推导出PBRT中一系列重要结论</p>
</blockquote>
<hr>
<blockquote>
<p><strong>极坐标与笛卡尔坐标</strong></p>
</blockquote>
<p>已知$p(x, y)=\frac{p(r, \theta)}{\arrowvert J_t(r, \theta) \arrowvert}$，其中<br>$$T_1(r,\theta)=rcos\theta=x \\<br>T_2(r,\theta)=rsin\theta=y$$</p>
<p>$$J_t(r, \theta)=\left[<br>\begin{matrix}<br>cos\theta &amp; -rsin\theta \\<br>sin\theta &amp; rcos\theta \\<br>\end{matrix}<br>\right] = r$$</p>
<p>则有$p(r, \theta) = rp(x, y)$</p>
<hr>
<blockquote>
<p><strong>球坐标与笛卡尔坐标</strong></p>
</blockquote>
<p>$$T_1(r,\theta, \phi)=rsin\theta cos\phi = x \\<br>T_2(r,\theta, \phi)=rsin\theta sin\phi = y \\<br>T_3(r,\theta, \phi)=rcos\theta = z$$</p>
<p>则$p(x, y, z)=\frac{p(r, \theta, \phi)}{\arrowvert J_t(r, \theta, \phi) \arrowvert}$，其中</p>
<p>$$J_t(r, \theta, \phi)=\left[<br>\begin{matrix}<br>sin\theta cos\phi &amp; rcos\theta cos\phi &amp; -rsin\theta sin\phi \\<br>sin\theta sin\phi &amp; rcos\theta sin\phi &amp; rsin\theta cos\phi \\<br>cos\theta &amp; -rsin\theta &amp; 0\\<br>\end{matrix}<br>\right] = r^2sin\theta$$</p>
<p>则有$p(r, \theta, \phi) = r^2sin\theta p(x, y, z)$。</p>
<hr>
<blockquote>
<p><strong>立体角与球坐标</strong></p>
</blockquote>
<p>立体角的定义为在单位圆上投影的面积，在球坐标中有$d\omega=sin\theta d\theta d\phi$成立</p>
<blockquote>
<p>因此基于物理Lambertion中的$\int_{\Omega}{f(\omega_i, \omega_o, p)cos\theta d\omega}$=1, 可得$f(\omega_i, \omega_o, p) = \frac{1}{\int_{0}^{2\pi}d\phi \int_{0}^{\frac{\pi}{2}}{cos\theta sin\theta d\theta}} = \frac{1}{\pi}$</p>
</blockquote>
<p>若定义在某区域$\Omega$上的概率为$Pr\{ \omega \in \Omega \} = \int_{\Omega}{p(\omega)d\omega}$，也有$Pr\{ (\theta ,\phi) \in \Omega ‘\} = \int_{\Omega ‘}{p(\theta, \phi)d\theta d\phi}$</p>
<p>因此<br>$$p(\theta, \phi)d\theta d\phi=p(\omega) d\omega$$<br>$$p(\theta, \phi)=sin\theta p(\omega)$$</p>
<hr>
<blockquote>
<p><strong>半球上立体角均匀采样</strong></p>
</blockquote>
<p>要对单位半球做关于立体角的均匀采样，则$p(\omega)=\frac{1}{2\pi}$，根据上文中与球坐标关系，$p(\theta, \phi)=\frac{sin\theta}{2\pi}$。</p>
<p>则有两独立同均匀分布随机变量$(\xi,\psi)\in [0,1]$，要转换成满足半球上均匀分布的球坐标表示。</p>
<p>$$p(\theta) = \int_{0}^{\frac{\pi}{2}}p(\theta, \phi)d\phi = sin\theta, \quad p(\phi) = \int_{0}^{2\pi}p(\theta, \phi)d\theta = \frac{1}{2\pi} $$</p>
<p>$$p(\theta \arrowvert \phi) = \frac{p(\theta, \phi)}{p(\phi)}=sin\theta, \quad p(\phi \arrowvert  \theta) = \frac{p(\theta, \phi)}{p(\theta)}=\frac{1}{2\pi}$$</p>
<blockquote>
<p>这里很明显可以看出来$\theta,\phi$为两个独立随机变量</p>
</blockquote>
<p>$$Pr\{\theta’ \leqslant  \theta\} = \int_{0}^{\theta}p(\theta)d\theta=1-cos\theta , Pr\{\phi’ \leqslant  \phi\} = \int_{0}^{\phi}p(\phi)d\phi=2\pi \phi$$</p>
<p>应用反CDF变换法则，$P^{-1}(\theta)=1-arccos\theta, P^{-1}(\phi)=2\pi \phi$，因此<br>$$\theta=arccos(1-\xi)=arccos\xi \\<br>\phi=2\pi \psi$$</p>
<p>由于球坐标不容易在计算机中表示，因此转换为笛卡尔表示</p>
<p>$$x=sin\theta cos\phi=\sqrt{1-\xi^2}cos2\pi \psi \\<br>y = sin\theta sin\phi = \sqrt{1-\xi^2}sin2\pi \psi \\<br>z = cos\theta = \xi$$ </p>
<blockquote>
<p>同理可推证球上立体角均匀采样</p>
</blockquote>
<blockquote>
<p>$$x=2\sqrt{\xi(1-\xi)}cos2\pi \psi \\<br>y = 2\sqrt{\xi(1-\xi)}sin2\pi \psi \\<br>z = 1-2\xi$$ </p>
</blockquote>
<p>下图为半球上均匀采样的结果与完整球上均匀采样的结果</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/32882394873/in/dateposted-public/" title="hemisphere and sphere" target="_blank" rel="noopener"><img src="https://c1.staticflickr.com/4/3827/32882394873_657e2d78a4_z.jpg" width="640" height="248" alt="hemisphere and sphere"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<hr>
<blockquote>
<p><strong>单位圆上的均匀采样</strong></p>
</blockquote>
<p>要根据面积对单位圆上进行均匀采样，$p(x,y)=\frac{1}{\pi}$，则$p(r, \theta)=rp(x,y)$。</p>
<p>$$p(\theta)=\int_{0}^{1}\frac{r}{\pi}dr=\frac{1}{2\pi}, \quad p(r\arrowvert \theta)=\frac{p(r,\theta)}{p(\theta)}=2r$$</p>
<p>则他们对于的CDF为$P(\theta)=\int_{0}^{\theta}p(\theta)d\theta=\frac{\theta}{2\pi}$，$P(r\arrowvert \theta)=\int_{0}^{r}p(r\arrowvert \theta)dr=r^2$</p>
<p>求出其对应反函数$P^{-1}(\theta)=2\pi\theta$，$P^{-1}(r\arrowvert \theta)=\sqrt{r}$</p>
<p>若有两满足在$[0, 1]$上均匀分布的随机变量$\xi, \psi$有$\theta=2\pi \xi, r=\sqrt{\psi}$</p>
<p>则转换回笛卡尔坐标结果为</p>
<p>$$x = \sqrt{\psi}cos2\pi \xi\\<br>y = \sqrt{\psi}sin2\pi \xi$$</p>
<blockquote>
<p>这里$r, \theta$也是两个独立的随机变量</p>
</blockquote>
<blockquote>
<p>PBRT中论述的Concentric Disk Sampling可以参见前文<a href="http://bentleyblanks.github.io/Depth-of-Field/">Depth of Field</a>中的实现与可视化</p>
</blockquote>
<hr>
<blockquote>
<p><strong>基于Cosine函数的半球采样</strong></p>
</blockquote>
<p>这里使用基本的转换思路，$p(\omega)\propto cos\theta$，因此$p(\omega)=\frac{cos\theta}{\pi}$</p>
<p>有$p(\theta, \phi)=\frac{sin\theta cos\theta}{\pi}$，则有</p>
<p>$$p(\theta)=\int_{0}^{2\pi}p(\theta, \phi)d\phi=2sin\theta cos\theta, \quad p(\phi \arrowvert \theta)=\frac{p(\theta, \phi)}{p(\theta)}=\frac{1}{2\pi}$$</p>
<p>可得CDF为</p>
<p>$$P(\theta)=\int_{0}^{\theta}p(\theta)d\theta=\frac{1-cos2\theta}{2}, \quad P(\phi \arrowvert \theta)=\int_{0}^{\phi}p(\phi \arrowvert \theta)d\phi=\frac{\phi}{2\pi}$$</p>
<p>应用反CDF得$P^{-1}(\theta)=\frac{1}{2}arccos(1-2\theta), P^{-1}(\phi \arrowvert \theta)=2\pi \phi$</p>
<p>$$\theta = \frac{1}{2}arccos(1-2\xi)\\<br>\phi = 2\pi \psi$$</p>
<p>转换为笛卡尔下的表示为<br>$$x=sin\theta cos\phi = sin(\frac{1}{2}arccos(1-2\xi)))cos2\pi\psi \\<br>y=sin\theta sin\phi =  sin(\frac{1}{2}arccos(1-2\xi)))sin2\pi\psi\ <br>z=cos\theta = cos(\frac{1}{2}arccos(1-2\xi))$$</p>
<blockquote>
<p>PBRT中给出了另一种计算办法，将均匀分布在圆盘上的点投影到半球上，其结果就满足Cosine-Weighted。</p>
</blockquote>
<p>以下给出证明</p>
<p>假定在圆盘上的极坐标分布为$p(r, \phi)=\frac{r}{\pi}$（使用$\phi$方便后续将$r$对应为$\theta$相关），$p(r, \phi)=\frac{p(\theta, \phi)}{\arrowvert J_t(r, \theta)\arrowvert}$</p>
<p>$$r=sin\theta = T_1(r) \\<br>\phi=\phi = T_2(\phi)$$</p>
<p>$$J_t(r, \theta)=\left[<br>\begin{matrix}<br>cos\theta &amp; 0 \\<br>0 &amp; 1 \\<br>\end{matrix}<br>\right] = cos\theta$$</p>
<p>即有$p(\theta, \phi)=cos\theta p(r, \phi)=\frac{r cos\theta}{\pi} = \frac{sin\theta cos\theta}{\pi}$，和上述中得到的结果一样。</p>
<blockquote>
<p>下图为两种方法产生的Cosine-Weighted对比</p>
</blockquote>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/33311690620/in/dateposted-public/" title="cartisan and projected" target="_blank" rel="noopener"><img src="https://c1.staticflickr.com/4/3838/33311690620_dabe17df74_z.jpg" width="640" height="248" alt="cartisan and projected"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<hr>
<blockquote>
<p><strong>三角形均匀采样</strong></p>
</blockquote>
<p>PBRT中采用了等腰切两边为1的三角形特殊情况，不过以下计算办法可以变换回任何三角形</p>
<p>有$p(u,v)=2$（面积倒数），则有</p>
<p>$$p(u)=\int_{0}^{1-u}p(u,v)dv=2-2u, \quad p(v\arrowvert u)=\frac{p(u,v)}{p(u)}=\frac{1}{1-u} \\<br>P(u)=\int_{0}^{u}p(u)du=2u-u^2, \quad P(v\arrowvert u)=\int_{0}^{v}p(v\arrowvert u)dv=\frac{v}{1-u}$$</p>
<blockquote>
<p>这里反变换CDF开根号时要注意到$u,v\in [0,1]$</p>
</blockquote>
<p>因此有$u=1-\sqrt{\xi},v=\sqrt{\xi}\psi$</p>
<blockquote>
<p>下图中即为三角形上的均匀采样</p>
</blockquote>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/33311534320/in/dateposted-public/" title="triangle sample" target="_blank" rel="noopener"><img src="https://c1.staticflickr.com/3/2841/33311534320_9991e8b365_z.jpg" width="640" height="339" alt="triangle sample"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<hr>
<blockquote>
<p><strong>根据二维分段函数分布采样</strong></p>
</blockquote>
<p>这里分段函数的采样即为离散随机变量，若有横向纵向各$n_u,n_v$个元素，函数上指定位置一点值为$f(u,v)$，那么就有</p>
<p>$$I_f=\int_v \int_u f(u,v)dudv=\frac{1}{n_un_v}\sum_{i=0}^{n_u-1}\sum_{j=0}^{n_v-1}f(u_i,v_j) \\<br>p(u,v)=\frac{f(u,v)}{I_f}$$</p>
<p>而边缘概率密度可直接得到<br>$$p(u)=\int_v p(u,v)dv=\frac{\frac{1}{n_u}\sum_i f(u, v_i)}{I_f} , \quad p(v\arrowvert u)=\frac{p(u,v)}{p(u)}=\frac{f(u,v)}{\frac{1}{n_u}\sum_i f(u, v_i)}$$</p>
<p>之后利用CDF反变换，即PBRT中distribution1d的实现办法可完成对于$p(u),p(v\arrowvert u)$上的采样</p>
<blockquote>
<p>此处效果可见<a href="http://bentleyblanks.github.io/Transforming-Between-Distributions/">前文</a>中的二维分段函数采样的结果</p>
</blockquote>
<hr>
<blockquote>
<p><strong>圆锥均匀采样</strong></p>
</blockquote>
<blockquote>
<p>类似于球上的均匀采样, 易证随机变量$\theta, \phi$相互独立</p>
</blockquote>
<p>已知$p(\omega)=\frac{1}{2\pi(1-cos\theta_{max})}$，则$p(\theta, \phi)=\frac{sin\theta}{2\pi(1-cos\theta_{max})}$</p>
<p>$$p(\theta)=\int_{0}^{2\pi}p(\theta, \phi)d\phi=\frac{sin\theta}{1-cos\theta_{max}}, \quad p(\phi)=\int_{0}^{2\pi}\frac{sin\theta}{2\pi(1-cos\theta_{max})}d\theta=\frac{1}{2\pi}$$</p>
<p>$$P(\theta)=\int_{0}^{\theta}\frac{sin\theta}{1-cos\theta_{max}}d\theta=\frac{1-cos\theta}{1-cos\theta_{max}}, \quad P(\phi)=\int_{0}^{\phi}\frac{1}{2\pi}d\phi=\frac{\phi}{2\pi}$$</p>
<p>若有两随机变量$xi, \psi$，运用反变换可有（此处省略了$\theta, \phi$到笛卡尔的转换）</p>
<p>$$cos\theta=1-\xi +\xi cos\theta_{max}, \quad \phi=2\pi\psi$$</p>
<blockquote>
<p>下图中即为圆锥上的均匀采样</p>
</blockquote>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/33700555886/in/dateposted-public/" title="cone sampling" target="_blank" rel="noopener"><img src="https://c1.staticflickr.com/3/2822/33700555886_1fe03e48cd_z.jpg" width="640" height="369" alt="cone sampling"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>

                      </p>
                    </div>
                  </div>
                  <br>
                  <br>
                  
                  <div class="card is-white is-hover" id="articleCard">
                    <div class="card-header">
                      <a href="/2018/03/12/2017-03-26-Transforming Between Distributions/" class="card-header-title">
                        Transforming Between Distributions
                      </a>
                    </div>
                    <div class="card-content">
                      <p id="articleContent">
                        <blockquote>
<p>关于连续型随机变量的分布转换，除了使用反CDF函数将均匀分布函数转换为其他分布函数以外，存在一种通用办法实现不同分布之间的转换，不只局限于均匀分布。</p>
</blockquote>
<p>假定存在随机变量$X$，其累积分布函数为$F_X(x)$。若存在单调函数$g$，使得$Y=g(X)$（因为是单调函数，因此$X$与$Y$的关系为单射），则为了计算$Y$的累积分布函数$F_Y(y)$，</p>
<blockquote>
<p>设$g(x)$此时为严格单调递增</p>
</blockquote>
<p>$$\begin{split}<br>F_Y(y) &amp; = &amp; Pr\{ Y\leqslant y \} \\<br>&amp; = &amp; Pr\{g(X)\leqslant y\} \\<br>&amp; = &amp; Pr\{ X\leqslant g^{-1}(y) \} \\<br>&amp; = &amp; F_X(g^{-1}(y))<br>\end{split}$$</p>
<p>此时对终式左右对x求导(累积分布函数导数为概率密度函数)</p>
<p>$$\begin{split}<br>f_Y(y)\frac{dy}{dx}=f_X(g^{-1}(y)) \\<br>f_Y(y) = (\frac{dy}{dx})^{-1}f_X(g^{-1}(y))  \\<br>\end{split}$$</p>
<blockquote>
<p>再设$g(x)$此时为严格单调递减</p>
</blockquote>
<p>$$\begin{split}<br>F_Y(y) &amp; = &amp; Pr\{ Y\leqslant y \} \\<br>&amp; = &amp; Pr\{g(X)\leqslant y\} \\<br>&amp; = &amp; 1 - Pr\{ X\leqslant g^{-1}(y) \} \\<br>&amp; = &amp; 1 - F_X(g^{-1}(y))<br>\end{split}$$</p>
<p>同样的有<br>$$f_Y(y) = -(\frac{dy}{dx})^{-1}f_X(g^{-1}(y))$$</p>
<p>则有$f_Y(y) = \arrowvert (\frac{dy}{dx})^{-1}\arrowvert f_X(g^{-1}(y))$。</p>
<blockquote>
<p>PBRT中讲到，当我们有一概率密度为$p_x(x)$的随机变量$X$，想要转换为满足已知分布为$p_y(y)$的随机变量$Y$，那么即有下式成立(此过程与上式正好相反)</p>
</blockquote>
<p>$$\begin{split}<br>F_X(x) &amp; = &amp; Pr\{ X\leqslant x \} \\<br>&amp; = &amp; Pr\{g(X)\leqslant g(x)\} \\<br>&amp; = &amp; Pr\{ Y\leqslant g(x) \} \\<br>&amp; = &amp; F_Y(g(x))<br>\end{split}$$</p>
<blockquote>
<p>$g(x) = F_Y^{-1}(F_X(x))$或当$g(X)$为单调减函数时$g(x) = F_Y^{-1}(1 - F_X(x))$，PBRT中未对此处进行详细说明。</p>
</blockquote>
<p>因此当$X$为满足$[0, 1]$区间均匀分布的随机变量时，$F_X(x)=x$，那么上式中$F_X(x))$或是$1 - F_X(x)$都满足$[0, 1]$区间均匀分布，则$g(x)=F_Y^{-1}(x)$，即Inverse Transform Sampling得证。</p>
<p>多维随机变量的转换$T(x)$为双射变换，则满足$f_Y(y)=f_Y(T(x))=\frac{f_X(x)}{\arrowvert J_T(x)\arrowvert }$，且$T(x)=(T_1(x),\cdots T_n(x))$</p>
<p>$$J_T(x)=\left[<br>\begin{matrix}<br> \frac{\partial T_1}{\partial x_1}    &amp; \cdots &amp; \frac{\partial T_1}{\partial x_n}      \\<br> \vdots &amp; \ddots &amp; \vdots \\<br> \frac{\partial T_n}{\partial x_1}    &amp; \cdots &amp; \frac{\partial T_n}{\partial x_n}      \\<br>\end{matrix}<br>\right]$$</p>

                      </p>
                    </div>
                  </div>
                  <br>
                  <br>
                  
                  <div class="card is-white is-hover" id="articleCard">
                    <div class="card-header">
                      <a href="/2018/03/12/2017-03-13-Monte Carlo Integration/" class="card-header-title">
                        Monte Carlo Integration
                      </a>
                    </div>
                    <div class="card-content">
                      <p id="articleContent">
                        <blockquote>
<p>蒙特卡洛方法求积分以及部分所需的概率论术语可以在<a href="http://www.pbrt.org/" target="_blank" rel="noopener">PBRT</a>以及概率论与数理统计中找到</p>
</blockquote>
<p>PBRT中给出了蒙特卡洛估计量，其中随机变量$X_i \in [a,b]$且独立同分布，分布满足概率密度函数 $p(x)$。</p>
<p>$$F_N = \frac{1}{N}\sum^{N}_{i=1}\frac{f(X_i)}{p(X_i)}$$</p>
<p>其期望为</p>
<p>$$\begin{split}<br>E[F_N] &amp; = E[\frac{1}{N}\sum_{i=1}^{N}\frac{f(X_i)}{p(X_i)}] \\<br>&amp; = \frac{1}{N}\sum_{i=1}^{N}\int_{a}^{b}\frac{f(x)}{p(x)}p(x)dx \\<br>&amp; = \frac{1}{N}\sum_{i=1}^{N}\int_{a}^{b}f(x)dx \\<br>&amp; = \int_{a}^{b}f(x)dx \\<br>\end{split}<br>$$</p>
<p>方差为 </p>
<p>$$\sigma^2=\frac{1}{N}\int(\frac{f(x)}{p(x)}-I)^2p(x)dx$$</p>
<p>结果的误差与标准差成正比，因此随着样本数增加误差缩小速度仅与$\sqrt{N}$相关(即常说的增加4倍采样数目才能缩小一半的误差)</p>
<blockquote>
<p>PBRT以及许多其他文章书籍等直接给出了这个估计量的期望计算（其中第二步到第三步并未直接说明来由，尽管PBRT在对期望的简介中已给出式子），这一步<strong>只能证明估计量本身无偏*</strong>。</p>
</blockquote>
<blockquote>
<p>以下将给出证明</p>
</blockquote>
<blockquote>
<p>引用一个知识点: <a href="https://en.wikipedia.org/wiki/Law_of_the_unconscious_statistician" target="_blank" rel="noopener">Law of the unconscious statistician</a>，简称LOTUS。用法是已知随机变量X的分布$f_X$，但并不知道函数g(X)的分布$f_{g(X)}$。那么此时函数$g(X)$的期望为</p>
</blockquote>
<blockquote>
<p>$E[g(X)]=\sum_x g(x)f_X(x)$(X为离散型随机变量)</p>
</blockquote>
<blockquote>
<p>$E[g(X)]=\int_{-\infty}^{\infty} g(x)f_X(x)dx$(X为连续型随机变量)</p>
</blockquote>
<blockquote>
<p>此处细节介绍也可以看<a href="http://www.qiujiawei.com/monte-carlo/" target="_blank" rel="noopener">Wyman的技术博客</a>，其中就提到了许多地方都没有涉及到的LOTUS。</p>
</blockquote>
<p>$$\begin{split}<br>E[ \frac {f(X_{i})}{pdf(X_{i})} ] &amp; = E[ \frac {f(x)}{pdf(x)} ] \\<br>&amp; = \int _{a}^{b}\frac {f(x)}{pdf(x)}pdf(x)dx \\<br>&amp; = \int _{a}^{b}f(x)dx<br>\end{split}<br>$$</p>
<blockquote>
<p>这里积分区间变为$[-\infty, \infty]$也是如此。以下将会使用到<a href="https://zh.wikipedia.org/wiki/%E5%A4%A7%E6%95%B0%E5%AE%9A%E5%BE%8B" target="_blank" rel="noopener">大数定律</a>的知识背景。</p>
</blockquote>
<blockquote>
<p>引用自维基百科：设 $a_{1},a_{2},…,a_{n},…$为相互独立的随机变量，其数学期望为： $E(a_{i})=\mu (i=1,2,…)$，方差为： $Var(a_{i})=\sigma ^{2}(i=1,2,…)$<br>则序列$\overline{a} = \frac{1}{n} \sum_{i=1}^{n}$，$a_{i}$ 依概率收敛于 $\mu$（即收敛于此数列的数学期望 $E(a_{i})$）。</p>
</blockquote>
<p>取一组独立同分布的随机变量$\{\xi\}$，且$\xi$在$[a,b]$内满足分布律$p(x)$，则令$p^<em>(x)=\frac{f(x)}{p(x)}$，**则$\{ p^</em>(\xi_i) \}$也是一组独立同分布的随机变量。**，那么计算其得到的期望其实就是积分本身(见下)。</p>
<p>由大数定理</p>
<p>$$Pr(\lim_{N\to\infty}\frac{1}{N}\sum_{i=1}^{N}p^*(\xi_i)=I)=1$$</p>
<p>那么这里已经有随机变量$\{ p^<em>(\xi_i) \}$存在，且期望等于积分值，**那么根据大数定理可知，这里的$\{ p^</em>(\xi_i) \}$就是会依概率收敛于积分值。**证毕。</p>

                      </p>
                    </div>
                  </div>
                  <br>
                  <br>
                  
              
          </div>
        </div>
      </div>
      <!-- about me -->
      <div class="column">
        <div class="card is-white is-hover is-hidden-mobile is-sticky">
          <div class="card-image">
            <figure class="image">
              <img src="http://pbrt.org/gallery/a3.jpg">
            </figure>
          </div>
          <div class="card-content">
            <div class="media">
              <div class="media-left">
                <figure class="image is-48x48">
                  <img src="https://github.com/BentleyBlanks.png">
                </figure>
              </div>
              <div class="media-content">
                <p class="title is-4">Bingo</p>
                <p class="subtitle is-6">@BentleyJobs</p>
              </div>
            </div>
            <div class="content">
              Graduated from <a href="https://www.jiangnan.edu.cn/">JNU</a>, interested in cg & game developing, once worked in <a href="https://www.aurogon.com/">Aurogon</a> to develope <a href="https://gjol.yy.com/">GuJianOL</a>. See <a href="">about</a> for more info.
            </div>
            <!-- icon link -->
            <div class="level is-mobile" id="iconLink">
              <!-- <div class="column"></div> -->

              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-map-marker" href="https://www.google.com/maps/place/Ningbo,+Zhejiang,+China/@29.8694844,121.2917787,10z/data=!3m1!4b1!4m5!3m4!1s0x344d6354630858f7:0x948723f846ccf173!8m2!3d29.868336!4d121.54399"></a>
              </div>
              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-github" href="https://github.com/BentleyBlanks/"></a>
              </div>
              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-envelope" href="mailto:bentleyjobs@gmail.com?subject=Hello%20again"></a>
              </div>
              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-weibo" href="https://weibo.com/2162074794"></a>
              </div>

              <!-- <div class="column"></div> -->
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="column"></div> -->
    </div>
  </div>
</section>

<div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/archives/2018/03/page/2/">
                    <span>pagination.older_posts</span>
                <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
        </li>
        
        <li class="pagination-number">pagination.page pagination.of</li>
    </ul>
</div>



<!-- Footer -->
<footer class="footer is-medium" id="footerStyle">
  <div class="container">
    <nav class="level is-mobile">
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>

      <div class="level-item has-text-centered">
        <img src="https://yellowdi.github.io/Elenore/images/elenore-icon-outlined.png" alt="Elenore logo" width="50">
      </div>

      <div class="level-item has-text-centered">
        <img src="https://raw.githubusercontent.com/hexojs/logo/master/hexo-logo-avatar-transparent-background.png" alt="Hexo logo" width="50">
      </div>
      
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
    </nav>

    <div class="columns has-text-centered">
      <div class="column">
        Theme Floekr developed By <a href="https://github.com/BentleyBlanks">Bingo</a>. Powered by <a href="https://yellowdi.github.io/Elenore">Elenore</a> and <a href="https://hexo.io/">Hexo</a>
      </div>
    </div>

  </div>
</footer>


  <!-- scripts list from theme config.yml -->
  
    <script src="/js/floekr.js" language="javascript"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  

</body>
</html>
