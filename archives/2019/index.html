


<!DOCTYPE html>
<html lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
  <!-- responsive -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Archives: 2019 [ Bingo ]</title>

  <link rel="apple-touch-icon" sizes="57x57" href="./img/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="./img/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="./img/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="./img/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="./img/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="./img/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="./img/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="./img/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./img/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="./img/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="./img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="./img/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./img/favicon-16x16.png">
  <link rel="manifest" href="./img/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="./img/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <!-- katex -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>

  <!-- highlight -->
  <link rel="stylesheet" href="/highlight/styles/monokai-sublime.css">
  <script src="/highlight/highlight.pack.js"></script>
  <!-- highlight line-number -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.3.0/highlightjs-line-numbers.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script>hljs.initLineNumbersOnLoad();</script>

  <!-- theme css -->
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/elenore/css/elenore.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="/css/animate.min.css">
    
      <link rel="stylesheet" href="/css/basic.css">
    
      <link rel="stylesheet" href="/css/floekr.css"><!-- hexo-inject:begin --><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css'><!-- hexo-inject:end -->
    
  

</head>
<body>

<!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Navigation Bar -->
<nav id="navbar" class="navbar is-white is-fixed-top">
  <div id="specialShadow" class="el-special-shadow"></div>
  <div class="container">

    <!-- left side, always visible -->
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <!-- <strong>Bingo</strong> -->
        <i class="fa fa-lg fa-home"></i>
      </a>

      <!-- toggles the menu on touch devices -->
      <div id="navbarBurger" class="navbar-burger burger" data-target="navMenu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <!-- menu -->
    <div id="navMenu" class="navbar-menu">
        <div class="navbar-end">
          
            
            <a href="/" class="navbar-item">HOME</a>
            

            

            
          
            

            

            
            <a href="/projects" class="navbar-item">PROJECTS</a>
            
          
            

            
            <a href="/about" class="navbar-item">ABOUT</a>
            

            
          
        </div>
    </div>
  </div>
</nav>

<!-- index hero -->
<div class="hero is-large has-background-fixed" id="indexHero">
  <div class="hero-body">
    <div class="container has-text-centered">
      <p id="titleContent">
        Bingo, <span>Computer Graphics</span> & <span>Game Developer</span>
      </p>
    </div>
  </div>
</div>

<!-- articles and about me -->

<section class="section">
  <div class="container">
    <!-- content and about me -->
    <div class="columns">

      <!-- blog -->
      <div class="column is-two-thirds">
        <div class="columns is-multiline">
          <div class="column is-12">
            <!-- articles -->
            
                
                  <!-- article card -->
                  <div class="card is-white is-hover wow fadeInUp" id="articleCard">
                    <div class="card-header">
                      <a href="/2019/09/07/2019-09-07-Screen Space Fog of War/" class="card-header-title">
                        <p></p>
                        <i class="fa fa-arrow-right" aria-hidden="true"></i>
                      </a>
                    </div>
                    <div class="card-content">
                      <p id="articleContent">
                        </p><h1 id="screen-space-fog-of-war"><a class="markdownIt-Anchor" href="#screen-space-fog-of-war"></a> Screen Space Fog of War</h1>
<p>战争迷雾本身有着非常多的实现方案，类似Dota这样的MOBA游戏早在WC3中就有迷雾的效果实现。这里介绍一个基于<strong>屏幕空间战争迷雾</strong>的实现效果。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48692504403/in/dateposted-public/" title="1563212000634" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48692504403_a688441f0b_o.png" width="1920" height="1080" alt="1563212000634"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48692847406/in/dateposted-public/" title="WC3" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48692847406_52716d030c_o.png" width="3197" height="1204" alt="WC3"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<hr>
<p>基于屏幕空间的战争迷雾，其核心是一张2D的ShadowMap，之后只需要在全屏Pass下，利用<strong>Depth+ClipSpacePosition</strong>来重建世界坐标，再从世界坐标转换到2D阴影贴图的局部坐标系下，即可得到当前像素的阴影值。</p>
<pre class="highlight"><code class="cpp"><span class="hljs-keyword">float</span> depth = DepthTexture.Sample(positionNDC);
float3 positionWS = float4(float3(positionNDC, depth) * <span class="hljs-number">2.0</span> - <span class="hljs-number">1.0f</span>, <span class="hljs-number">1.0f</span>);
positionWS = mul(_inverseVP, positionWS);
positionWS.xyz /= positionWS.w;
</code></pre>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48692503303/in/dateposted-public/" title="DepthAndPositionWS" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48692503303_d3cba8374b_o.png" width="3842" height="918" alt="DepthAndPositionWS"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<blockquote>
<p>左图为Depth, 右图为重建出的<strong>WorldSpace Position</strong>。</p>
</blockquote>
<p>因此基于屏幕空间的战争迷雾，最核心的就是计算得到的2D阴影贴图，以下列举的不同方案只是在计算这张阴影贴图的过程有所不同。</p>
<hr>
<h2 id="grid"><a class="markdownIt-Anchor" href="#grid"></a> Grid</h2>
<p><strong>Introduction</strong></p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48693017382/in/dateposted-public/" title="1564411522311" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48693017382_58c54c614d_o.png" width="1919" height="916" alt="1564411522311"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p>网格方案在WC3时代就已经被广泛应用，将地图<strong>预计算</strong>为一张地图障碍物贴图，CPU根据玩家位置实时填充数据，以计算视野阴影贴图。最后转为GPU可读的RT作为2D Shadow。由于CPU填充能力较低，一般最后会辅以<strong>Blur</strong>来弥补画面缺陷。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48692851256/in/dateposted-public/" title="Grid-3" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48692851256_a6300d366b_o.png" width="384" height="128" alt="Grid-3"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<blockquote>
<p>左图为预计算的地图障碍物贴图，中间为当前帧可视范围。这里对象移动过的范围将会被标记为<strong>已探索</strong>，一般实际游戏会对这块区域做提亮操作，如图中白色部分表示为已知探索范围。</p>
</blockquote>
<p>核心的CPU填充算法非常直观，本质就是借助队列实现的四邻域填充算法</p>
<pre class="highlight"><code class="cpp"><span class="hljs-built_in">queue</span>.Enqueue(rootPixel);
<span class="hljs-keyword">while</span>(<span class="hljs-built_in">queue</span>.Count &gt; <span class="hljs-number">0</span>) {
	current = <span class="hljs-built_in">queue</span>.Dequeue();

	<span class="hljs-comment">// if rootPixel could see current pixel</span>
	<span class="hljs-keyword">if</span>(RayCast(current, rootPixel)) 
		SetVisible(root);

	<span class="hljs-comment">// spread the visible area around root position in four direction</span>
	EnqueueAtPosition(root.x - <span class="hljs-number">1</span>, root.y, rootPixels, radius);
	EnqueueAtPosition(root.x, root.y - <span class="hljs-number">1</span>, rootPixels, radius);
	EnqueueAtPosition(root.x + <span class="hljs-number">1</span>, root.y, rootPixels, radius);
	EnqueueAtPosition(root.x, root.y + <span class="hljs-number">1</span>, rootPixels, radius);
}
</code></pre>
<p>由于CPU在填充过程中需要等待，因此将数据更新<strong>另开线程</strong>，则阴影贴图的更新可以延迟于玩家移动，不影响主线程整体运行表现。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48693023767/in/dateposted-public/" title="Grid-4" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48693023767_23cdab2c44_o.png" width="128" height="128" alt="Grid-4"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p>为了弥补多线程填充完成带来的突变感，存下当前迷雾帧以及上一帧的数据(Texture中R和B通道)，在渲染时对其进行<strong>插值过渡</strong>，以避免突兀。</p>
<blockquote>
<p>在WC3中，移动到一定距离才会触发迷雾的更新，和上述思路基本类似</p>
</blockquote>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48692844231/in/dateposted-public/" title="FOWGrid0" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48692844231_45b5f5b9b5_o.gif" width="948" height="668" alt="FOWGrid0"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p>网格方案较为流行也容易实现，但由于CPU填充能力有限，即便是能做到仅对<strong>脏区域局部更新</strong>，CPU仍然对高分辨率的需求无法得到较好的满足，且最后一般都需要提供较为高昂的Blur来模糊分辨率带来的界限。不过由于迷雾的特性，低分辨率有时反倒在边缘上能带来更好的过渡感。</p>
<p><strong>Reference</strong></p>
<blockquote>
<p><a href="https://blog.csdn.net/xoyojank/article/details/12259161" target="_blank" rel="noopener">游戏中的战争迷雾</a></p>
<p><a href="https://blog.csdn.net/mobilebbki399/article/details/78444375" target="_blank" rel="noopener">【Unity】FOV战争迷雾</a></p>
<p><a href="https://github.com/AsehesL/FogOfWar" target="_blank" rel="noopener">unity下一种基于渲染可见区域的战争迷雾</a></p>
</blockquote>
<hr>
<h2 id="signed-distance-field-shadow"><a class="markdownIt-Anchor" href="#signed-distance-field-shadow"></a> Signed Distance Field Shadow</h2>
<p><strong>Introduction</strong></p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48693017102/in/dateposted-public/" title="FinalResult-1" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48693017102_099657f010_o.png" width="1917" height="918" alt="FinalResult-1"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p>SDF方案对CPU最为友好，几乎所有计算都可以在GPU中完成。若为静态场景可<strong>预bake</strong>场景成一张障碍物贴图，动态场景可使用正交投影相机在上方正交拍摄Depth再转换得到。之后使用SDF生成算法对这张障碍物贴图计算<strong>Min Signed Distance</strong>。最后对这张SDF进行RayMarching来得到一张2D阴影贴图。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48692850886/in/dateposted-public/" title="MapDataAndSDF" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48692850886_ed15d451ab_o.png" width="1536" height="512" alt="MapDataAndSDF"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<blockquote>
<p>从左至右依次为场景Map的障碍物信息，计算得到的SDF贴图，以及最终的2D阴影贴图。</p>
</blockquote>
<p>本文选用JFA算法(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><msup><mi>e</mi><mrow><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">Reference^{[1]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0824399999999998em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">1</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>)来实时更新SDF贴图。其支持<strong>GPU并行</strong>，且复杂度仅为<strong>O(Nlogn)</strong>。要求是Texture的分辨率需要为2的幂次方。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48693023677/in/dateposted-public/" title="JFA-1" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48693023677_95c4f6553e_o.png" width="1820" height="572" alt="JFA-1"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<blockquote>
<p>链接为作者描述JFA的Phd论文，也可以查看<a href="https://link.zhihu.com/?target=http%3A//citeseerx.ist.psu.edu/viewdoc/download%3Fdoi%3D10.1.1.101.8568%26rep%3Drep1%26type%3Dpdf" target="_blank" rel="noopener">Jump Flooding in GPU with Applications to Voronoi Diagram and Distance Transform</a>，但上面这篇在错误分析和变种应用上讲解的更为详尽。</p>
</blockquote>
<blockquote>
<p>SDF生成算法有较多种，可以参考<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>2</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[2]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">2</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>中第五章中提供的几种经典算法来生成SDF贴图</p>
</blockquote>
<p>JFA的具体思路就是，将复杂的待计算的格点p到3D表面或者2D形状边缘的距离，转化多Pass下，每个Pass中p找到<strong>八邻域</strong>3D/2D坐标于Seed的距离。其选择的八邻域到p的距离<strong>Step</strong>，将会不断除2直至为1(logN/2, logN/4, … 16, 8, 4, 2, 1)后得到最终的SDF Texture。</p>
<pre class="highlight"><code class="cpp"><span class="hljs-keyword">float</span> power = Math.Log2(textureWidth);
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= power; i++) {
	<span class="hljs-keyword">int</span> index0 = i % <span class="hljs-number">2</span>;
	<span class="hljs-keyword">int</span> index1 = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span>;
	
	mat.SetFloat(<span class="hljs-string">"_Power"</span>, power);
	mat.SetFloat(<span class="hljs-string">"_Level"</span>, i);
	mat.SetTexture(<span class="hljs-string">"_SDFTexture"</span>, pingpong[index0]);

	Blit(mat, pingpong[index1]);
}
</code></pre>
<pre class="highlight"><code class="cpp"><span class="hljs-keyword">float</span> stepwidth = _Power - _Level + <span class="hljs-number">1</span>;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = <span class="hljs-number">-1</span>; y &lt;= <span class="hljs-number">1</span>; ++y) {
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">-1</span>; x &lt;= <span class="hljs-number">1</span>; ++x) {
		<span class="hljs-comment">// Sample semi-finished sdf texture</span>
		float2 uv = texCoord + float2(x, y) * _TexelSize * stepwidth;
		float4 value = Sample(_SDFTexture, uv);
		float2 seedCoord  = value.zw;
 
		<span class="hljs-keyword">float</span> distance = length(texCoord - seedCoord);
		<span class="hljs-keyword">if</span> ((seedCoord.x != <span class="hljs-number">0.0</span> || seedCoord.y != <span class="hljs-number">0.0</span>) &amp;&amp; distance &lt; minDistance) {
			minDistance = distance;
			minCoord    = seedCoord;
        }
    }
}
</code></pre>
<blockquote>
<p>JFA本身是存在一定error的，但作者在文章中对不同场景提出了几个算法上的变种(JFA2, 1+JFA…)用于减少Error。上述Phd论文中还分享了在Voronoi Diagram，Delaunay Triangulation, Direct Shadow等应用的原理</p>
</blockquote>
<p>计算2D Shadow中的Sphere RayMarching本身很好理解，将SDF图中采样的值，也就是到边界的最近距离作为步进的最长距离(步进更大的距离将可能与已有边界碰撞)。</p>
<pre class="highlight"><code class="cpp"><span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">drawShadow</span><span class="hljs-params">(float2 uv, float2 lightPos)</span>
</span>{
    float2 direction = normalize(lightPos - uv);
    float2 p = uv;
    <span class="hljs-keyword">float</span> distanceToLight = length(uv - lightPos);
    <span class="hljs-keyword">float</span> distance = <span class="hljs-number">0.0f</span>;

    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {
        <span class="hljs-keyword">float</span> s = Sample(_SDFTexture, p);

        <span class="hljs-keyword">if</span>(s &lt;= <span class="hljs-number">0.00001</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
        <span class="hljs-keyword">if</span>(distance &gt; distanceToLight) <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>;

        distance += max(s * _StepScale, _StepMinValue);
        p = uv + direction * distance;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
}
</code></pre>
<p>SDF本身是可以直接计算出半影的，但在边界上存在<strong>较为严重的BandingArtifact</strong>，各类文献报告中均有对此进行改善缓解，一般会选用混合方案来避免这样的问题。其中也有改进后的ConeTracing方法，在UE4以及<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><msup><mi>e</mi><mrow><mo stretchy="false">[</mo><mn>2</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">Reference^{[2]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0824399999999998em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">2</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>中有过提及。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48693023452/in/dateposted-public/" title="SDF2" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48693023452_dd70c48049_o.png" width="1600" height="450" alt="SDF2"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<blockquote>
<p>左图为SDF直接计算得到的半影，右图则为在边界上RayMarching带来的精度不够导致的BandingArtifact现象</p>
</blockquote>
<p>演示中为了避免BandingArtifact，并没有直接算出半影而是算出二值图最后配合Blur，并按距离增大Blur半径来模拟半影的效果。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48692501968/in/dateposted-public/" title="FOWSDF0" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48692501968_9a52eaf3e6_o.gif" width="948" height="668" alt="FOWSDF0"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p><strong>Reference</strong></p>
<blockquote>
<p><a href="https://www.comp.nus.edu.sg/~tants/jfa/rong-guodong-phd-thesis.pdf" target="_blank" rel="noopener">Jump Flooding in GPU with Applications to Voronoi Diagram and Distance Transform</a></p>
<p><a href="https://static1.squarespace.com/static/559921a3e4b02c1d7480f8f4/t/596773e9f7e0ab3d29bb102f/1499952110561/Mroz+Michael_746.pdf" target="_blank" rel="noopener">Signed Distance Fields in Real-Time Rendering</a></p>
<p><a href="https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch30.html" target="_blank" rel="noopener">Chapter 30. Real-Time Simulation and Rendering of 3D Fluids</a></p>
<p><a href="https://www.shadertoy.com/view/Mdy3DK" target="_blank" rel="noopener">Jump Flood Algorithm: Points </a></p>
<p><a href="https://www.shadertoy.com/view/lsKGDV" target="_blank" rel="noopener">Jump Flood Algorithm: Shapes</a></p>
<p><a href="https://www.shadertoy.com/view/4dfXDn" target="_blank" rel="noopener">2d signed distance functions </a></p>
</blockquote>
<hr>
<h2 id="mesh-projetion"><a class="markdownIt-Anchor" href="#mesh-projetion"></a> Mesh Projetion</h2>
<p><strong>Introduction</strong></p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48692509073/in/dateposted-public/" title="SFSS-0" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48692509073_52d74c40d4_o.png" width="1918" height="918" alt="SFSS-0"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p>2D阴影由于其特殊性，可以由CPU直接计算出一个变形后的Mesh作为平面的阴影区域。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48693023072/in/dateposted-public/" title="SFSS-2-1567850455727" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48693023072_2232f99029_o.png" width="2637" height="670" alt="SFSS-2-1567850455727"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<blockquote>
<p>这里需要对障碍物进行边缘编辑，以调整出适应形状的阴影区域</p>
</blockquote>
<p>对场景中所有变形后的Mesh，多次的渲染到一张RT上，即可得到所需的2D Shadow Map(本方法在Demo中并未涵盖，可参考Asset Store的<strong>SFSS插件</strong>)</p>
<p>若是场景中物体较多，则计算阴影区域的CPU压力将会较大，且即便为静态场景可能也需要多次的DrawMesh才能得到最后的2D ShadowMap。但其优势是在Shader中较前两者，可以较好的控制半影区域的绘制，以得到高质量的阴影结果。</p>
<p><a data-flickr-embed="true" href="https://www.flickr.com/photos/134486032@N03/48692850321/in/dateposted-public/" title="SFSS-4-1567850431805" target="_blank" rel="noopener"><img src="https://live.staticflickr.com/65535/48692850321_e450af8b50_o.gif" width="1024" height="491" alt="SFSS-4-1567850431805"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script></p>
<p><strong>Reference</strong></p>
<blockquote>
<p><a href="https://assetstore.unity.com/packages/tools/sprite-management/sf-soft-shadow-2d-38682" target="_blank" rel="noopener">Unity Asset Store: SF Soft Shadow 2D</a></p>
</blockquote>
<hr>
<h2 id="summary"><a class="markdownIt-Anchor" href="#summary"></a> Summary</h2>
<p>由于实现战争迷雾的方案较多，这里仅提供一个基于屏幕空间战争迷雾的提供了上述几种方案实现的项目<a href="https://github.com/BentleyBlanks/FOW" target="_blank" rel="noopener">FOW</a>以供参考。</p>
<blockquote>
<p>Demo中SDF可使用较高分辨率来完成实时预览一般给定128x128或者256x256皆可(过高分辨率需要更多次的Blur来带来半影的效果)。</p>
<p>而CPU的填充版本则由于C填充性能有限，因此建议给定64 x 64或32 x 32获得更平滑的效果。</p>
</blockquote>

                      <p></p>
                    </div>
                  </div>
                  <br>
                  <br>
                  
              
          </div>
        </div>
      </div>

      <!-- about me -->
      <div class="column">
        <div class="card is-white is-hover is-hidden-mobile is-sticky" id="indexAboutMe">
          <div class="card-image">
            <figure class="image">
              <img src="http://pbrt.org/gallery/a3.jpg">
            </figure>
          </div>
          <div class="card-content">
            <div class="media">
              <div class="media-left">
                <figure class="image is-48x48">
                  <img src="https://github.com/BentleyBlanks.png">
                </figure>
              </div>
              <div class="media-content">
                <p class="title is-4">Bingo</p>
                <p class="subtitle is-6">@BentleyJobs</p>
              </div>
            </div>
            <div class="content">
              Graduated from <a href="https://www.jiangnan.edu.cn/">JNU</a>, interested in cg & game developing, once worked in <a href="https://www.aurogon.com/">Aurogon</a> to develope <a href="https://gjol.yy.com/">GuJianOL</a>. See <a href>about</a> for more info.
            </div>
            <!-- icon link -->
            <div class="level is-mobile" id="iconLink">
              <!-- <div class="column"></div> -->

              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-map-marker" href="https://www.google.com/maps/place/Ningbo,+Zhejiang,+China/@29.8694844,121.2917787,10z/data=!3m1!4b1!4m5!3m4!1s0x344d6354630858f7:0x948723f846ccf173!8m2!3d29.868336!4d121.54399"></a>
              </div>
              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-github" href="https://github.com/BentleyBlanks/"></a>
              </div>
              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-envelope" href="mailto:bentleyjobs@gmail.com?subject=Hello%20again"></a>
              </div>
              <div class="level-item has-text-centered">
                <a class="fa fa-lg fa-weibo" href="https://weibo.com/2162074794"></a>
              </div>

              <!-- <div class="column"></div> -->
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="column"></div> -->
    </div>
  </div>
</section>

<!-- <section class="section">
    <div class="container">
        <div class="columns">
            <div class="column is-two-thirds">
                <nav class="pagination is-centered" role="navigation" aria-label="pagination">
                    
                        <a class="pagination-previous" href="/">
                    
                    Previous
                    </a>

                    <ul class="pagination-list">
                        
                        
                        <li><a class="pagination-link is-current">1</a></li>
                        
                        
                    </ul>
                    
                    
                        <a class="pagination-next" href="/">
                    
                    Next
                    </a>
                </nav>
            </div>

            <div class="column"></div>
        </div>
    </div>
</section> -->

<section class="section">
    <div class="container">
        <div class="columns">
            <div class="column is-two-thirds">
                <nav class="pagination is-centered" role="navigation" aria-label="pagination">
                    
                        <a class="pagination-previous" href="/">
                    
                    Previous
                    </a>

                    <ul class="pagination-list">
                        
                        
                        <li><a class="pagination-link is-current">1</a></li>
                        
                        
                    </ul>
                    
                    
                        <a class="pagination-next" href="/">
                    
                    Next
                    </a>
                </nav>
            </div>

            <div class="column"></div>
        </div>
    </div>
</section>


<!-- Footer -->
<footer class="footer is-medium" id="footerStyle">
  <div class="container">
    <nav class="level is-mobile">
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>

      <div class="level-item has-text-centered">
        <img src="https://yellowdi.github.io/Elenore/images/elenore-icon-outlined.png" alt="Elenore logo" width="50">
      </div>

      <div class="level-item has-text-centered">
        <img src="https://raw.githubusercontent.com/hexojs/logo/master/hexo-logo-avatar-transparent-background.png" alt="Hexo logo" width="50">
      </div>
      
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
      <div class="level-item has-text-centered"></div>
    </nav>

    <div class="columns has-text-centered">
      <div class="column">
        Theme Floekr developed By <a href="https://github.com/BentleyBlanks">Bingo</a>. Powered by <a href="https://yellowdi.github.io/Elenore">Elenore</a> and <a href="https://hexo.io/">Hexo</a>
      </div>
    </div>

  </div>
</footer>


  <!-- scripts list from theme config.yml -->
  
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" language="javascript"></script>
  
    <script src="/js/wow.min.js" language="javascript"></script>
  
    <script src="/js/floekr.js" language="javascript"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  

</body>
</html>
